"use strict";(self.webpackChunktwilight=self.webpackChunktwilight||[]).push([[610],{610:(t,e,n)=>{n.r(e),n.d(e,{matchingGamePage:()=>S,matchingLobbyPage:()=>T});var r=n(358);function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}const i=function(){function t(e,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.pos=r.Z.createVector(n,o),this.points=0}var e,n;return e=t,(n=[{key:"addPoints",value:function(t){this.points+=t}},{key:"setPos",value:function(t,e){this.pos.set(t,e)}},{key:"render",value:function(t){r.Z.fill(13,65,67),t&&r.Z.triangle(this.pos.x,this.pos.y-90*r.Z.getScale,this.pos.x-10*r.Z.getScale,this.pos.y-100*r.Z.getScale,this.pos.x+10*r.Z.getScale,this.pos.y-100*r.Z.getScale),r.Z.fill(255),r.Z.text("".concat(this.name,"\nScore\n")+this.points,this.pos.x,this.pos.y)}}])&&o(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();var a=n(32);function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}const c=function(){function t(e,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.pos=r.Z.createVector(e,n),this.mystery=a.D.getCurrentPage().mystery,this.cards=o,this.revealed=!1}var e,n;return e=t,(n=[{key:"render",value:function(){r.Z.image(this.revealed?this.cards[this.type]:this.mystery,this.pos.x,this.pos.y,150*r.Z.getScale,200*r.Z.getScale),this.revealed&&r.Z.image(this.border,this.pos.x,this.pos.y-3*r.Z.getScale,155*r.Z.getScale,209*r.Z.getScale)}},{key:"setBorder",value:function(t){this.border=t}},{key:"reveal",value:function(t){this.type=t,this.revealed=!0}},{key:"unreveal",value:function(){this.type=null,this.revealed=!1}},{key:"pressed",value:function(){return r.Z.mouseX>this.pos.x-75*r.Z.getScale&&r.Z.mouseX<this.pos.x+75*r.Z.getScale&&r.Z.mouseY>this.pos.y-100*r.Z.getScale&&r.Z.mouseY<this.pos.y+100*r.Z.getScale}}])&&s(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();var u=n(979);function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function f(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}const h=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.first=new i(e.username,500*r.Z.getScale,r.Z.height/2),this.second=new i(e.opponentname,1333*r.Z.getScale,r.Z.height/2),this.animation=!1,this.handleNewBoard(),this.newBoard()}var e,n;return e=t,(n=[{key:"onUpdate",value:function(){this.animation&&r.Z.millis()-this.startMs>1e3&&(this.animation=!1);for(var t=0;t<this.gridH;t++)for(var e=0;e<this.gridW;e++)this.grid[t][e].render();this.first.render(this.turn),this.second.render(!this.turn)}},{key:"onWindowResized",value:function(){this.offX=(r.Z.width-170*(this.gridW-1)*r.Z.getScale)/2,this.first.setPos(this.offX/2,r.Z.height/2),this.second.setPos(r.Z.width-this.offX/2,r.Z.height/2);for(var t=0;t<this.gridH;t++)for(var e=0;e<this.gridW;e++)this.grid[t]||(this.grid[t]=[]),this.grid[t][e].pos.set(170*e*r.Z.getScale+this.offX,220*t*r.Z.getScale+200*r.Z.getScale)}},{key:"newBoard",value:function(){console.log("Requested a new board"),u.G.socket.emit("matching:newBoard")}},{key:"handleNewBoard",value:function(){var t=this;u.G.socket.on("matching:board",(function(e){console.log("New board is here");var n={};t.turn=e.turn==u.G.socket.id;var o,i=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}(e.cardList);try{var a=function(){var t=o.value;r.Z.loadImage("/assets/matching/".concat(t,".png"),(function(e){return n[t]=e}),console.log)};for(i.s();!(o=i.n()).done;)a()}catch(t){i.e(t)}finally{i.f()}t.gridW=e.gridW,t.gridH=e.gridH,t.offX=(r.Z.width-170*(t.gridW-1)*r.Z.getScale)/2,t.first.setPos(t.offX/2,r.Z.height/2),t.second.setPos(r.Z.width-t.offX/2,r.Z.height/2),t.grid=[];for(var s=0;s<t.gridH;s++)for(var f=0;f<t.gridW;f++)t.grid[s]||(t.grid[s]=[]),t.grid[s][f]=new c(170*f*r.Z.getScale+t.offX,220*s*r.Z.getScale+200*r.Z.getScale,n)})),u.G.socket.on("matching:reveal",(function(e){null==t.fir?(t.fir=t.grid[e.y][e.x],t.fir.reveal(e.type),t.fir.setBorder(t.turn?a.D.getCurrentPage().redBorder:a.D.getCurrentPage().blueBorder)):(t.sec=t.grid[e.y][e.x],t.sec.reveal(e.type),t.sec.setBorder(t.turn?a.D.getCurrentPage().redBorder:a.D.getCurrentPage().blueBorder),t.animation=!0,t.startMs=r.Z.millis())})),u.G.socket.on("matching:correct",(function(e){setTimeout((function(){t.turn?t.first.addPoints(e.points):t.second.addPoints(e.points),t.turn=u.G.socket.id==e.turn,t.fir=null,t.sec=null}),1e3)})),u.G.socket.on("matching:incorrect",(function(e){setTimeout((function(){t.turn=u.G.socket.id==e.turn,t.fir.unreveal(),t.sec.unreveal(),t.fir=null,t.sec=null}),1e3)})),u.G.socket.on("matching:waitForNewBoard",(function(){}))}},{key:"reset",value:function(){this.first.points=0,this.second.points=0,this.turn=!1,this.fir=null,this.sec=null,this.animation=!1,this.newBoard()}},{key:"onMousePress",value:function(){if(!this.animation&&!this.second.turn)for(var t=0;t<this.gridH;t++)for(var e=0;e<this.gridW;e++)if(this.grid[t][e].pressed()&&!this.grid[t][e].revealed)return void u.G.socket.emit("matching:openCard",{x:e,y:t})}}])&&f(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();var d=n(710),y=n(939),g=n(949);function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Z(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function m(t,e){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},m(t,e)}function v(t,e){if(e&&("object"===p(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function w(t){return w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},w(t)}var S=new(function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&m(t,e)}(s,t);var e,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=w(o);if(i){var n=w(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return v(this,t)});function s(){return b(this,s),a.apply(this,arguments)}return e=s,(n=[{key:"onCreate",value:function(t){this.backgroundImage=r.Z.loadImage("/assets/matching/background.png"),this.mystery=r.Z.loadImage("/assets/matching/secret.png"),this.blueBorder=r.Z.loadImage("/assets/matching/blue.png"),this.redBorder=r.Z.loadImage("/assets/matching/red.png"),r.Z.noSmooth(),r.Z.textAlign(r.Z.CENTER,r.Z.CENTER),r.Z.rectMode(r.Z.CENTER),r.Z.imageMode(r.Z.CENTER),r.Z.textSize(g.HI*r.Z.getScale),this.board=new h(t),this.restart=new y.Av("New Board",r.Z.width/2-300*r.Z.getScale,7*r.Z.height/8,400*r.Z.getScale,60*r.Z.getScale),this.restart.setOnClickListener(this.board.newBoard),this.reset=new y.Av("Reset Game",r.Z.width/2+300*r.Z.getScale,7*r.Z.height/8,400*r.Z.getScale,60*r.Z.getScale),this.reset.setOnClickListener(this.board.reset)}},{key:"onUpdate",value:function(){r.Z.background(0),this.backgroundImage&&r.Z.image(this.backgroundImage,r.Z.width/2,r.Z.height/2,r.Z.width,r.Z.height),this.board.onUpdate(),this.restart.onUpdate(),this.reset.onUpdate()}},{key:"onWindowResized",value:function(){this.restart.pos.set(r.Z.width/2-200*r.Z.getScale,7*r.Z.height/8),this.restart.size.set(300*r.Z.getScale,50*r.Z.getScale),this.reset.pos.set(r.Z.width/2+200*r.Z.getScale,7*r.Z.height/8),this.reset.size.set(300*r.Z.getScale,50*r.Z.getScale),this.board.onWindowResized()}},{key:"onMousePress",value:function(){this.board.onMousePress(),this.restart.onMousePress(),this.reset.onMousePress()}}])&&Z(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),s}(d.T3));function k(t){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},k(t)}function P(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=O(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function O(t,e){if(t){if("string"==typeof t)return j(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?j(t,e):void 0}}function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function E(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function x(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function C(t,e){return C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},C(t,e)}function R(t,e){if(e&&("object"===k(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function B(t){return B=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},B(t)}var T=new(function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&C(t,e)}(c,t);var e,n,o,i,s=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=B(o);if(i){var n=B(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return R(this,t)});function c(){return E(this,c),s.apply(this,arguments)}return e=c,(n=[{key:"onCreate",value:function(){r.Z.rectMode(r.Z.CENTER),r.Z.textAlign(r.Z.CENTER,r.Z.CENTER),r.Z.imageMode(r.Z.CENTER),r.Z.noStroke(),this.loading=!0,this.buttons=[],this.joinLobby(),this.getLobbies()}},{key:"onUpdate",value:function(){if(r.Z.background(g.eh),r.Z.textSize(g.mU*r.Z.getScale),r.Z.fill(g.zP),r.Z.text("Matching Lobby",r.Z.width/2,r.Z.height/10),r.Z.textSize(g.HI*r.Z.getScale),r.Z.text("🔃",r.Z.width-50*r.Z.getScale,50*r.Z.getScale),this.loading)return r.Z.text("Loading",r.Z.width/2,r.Z.height/2+100*r.Z.getScale),r.Z.textSize(g.mU*r.Z.getScale),r.Z.push(),r.Z.translate(r.Z.width/2,r.Z.height/2),r.Z.rotate(r.Z.frameCount/10),r.Z.text("↻",-2*r.Z.getScale,11*r.Z.getScale),void r.Z.pop();var t,e=P(this.buttons);try{for(e.s();!(t=e.n()).done;)t.value.onUpdate()}catch(t){e.e(t)}finally{e.f()}}},{key:"onWindowResized",value:function(){var t,e,n,o=P(this.buttons.entries());try{for(o.s();!(t=o.n()).done;){var i=(e=t.value,n=2,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(e,n)||O(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=i[0],s=i[1];s.pos.set(a%2?2*r.Z.width/3:r.Z.width/3,Math.floor(a/2+2)*r.Z.height/10),s.size.set(400*r.Z.getScale,50*r.Z.getScale)}}catch(t){o.e(t)}finally{o.f()}}},{key:"onMousePress",value:function(){var t,e=P(this.buttons);try{for(e.s();!(t=e.n()).done;)t.value.onMousePress()}catch(t){e.e(t)}finally{e.f()}r.Z.mouseX<r.Z.width-30*r.Z.getScale&&r.Z.mouseX>r.Z.width-70*r.Z.getScale&&r.Z.mouseY<70*r.Z.getScale&&r.Z.mouseY>30*r.Z.getScale&&this.getLobbies()}},{key:"joinLobby",value:function(){this.page=0,u.G.joinLobby("matching",this.startGame)}},{key:"startGame",value:function(t){var e=this;t.on("matching:startGame",(function(t){a.D.push("matching/matchingGamePage",{username:u.G.user.username,opponentname:t.username})})),t.on("matching:alreadyPlaying",(function(){e.getLobbies()}))}},{key:"getLobbies",value:function(){var t=this;this.loading=!0,u.G.getLobby("matching",0+16*this.page,16+16*this.page,(function(e){t.loading=!1,t.buttons=[];var n,o=P(e);try{var i=function(){var e=n.value,o=new y.Av(e.username,t.buttons.length%2?2*r.Z.width/3:r.Z.width/3,Math.floor(t.buttons.length/2+2)*r.Z.height/10,400*r.Z.getScale,50*r.Z.getScale);o.setOnClickListener((function(n){return t.lobbyButtonListener(n,e)})),t.buttons.push(o)};for(o.s();!(n=o.n()).done;)i()}catch(t){o.e(t)}finally{o.f()}}))}},{key:"lobbyButtonListener",value:function(t,e){t&&u.G.joinRoom("matching",e)}}])&&x(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),c}(d.T3))}}]);